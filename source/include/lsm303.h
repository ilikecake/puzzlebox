//  LSM303 Header File
//  9/4/2011 - PDS

#ifndef _LSM303_H_
#define _LSM303_H_

#include <stdint.h>

#define LSM303_BUFFER_SIZE	8

//7-bit I2C addresses
#define LSM303_ACCELEROMETER_ADDRESS		0x18
#define LSM303_MAGNETOMETER_ADDRESS			0x1E

//Define registers
#define LSM303_ACCELEROMETER_CTRL_REG1			0x20
#define LSM303_ACCELEROMETER_CTRL_REG2			0x21
#define LSM303_ACCELEROMETER_CTRL_REG3			0x22
#define LSM303_ACCELEROMETER_CTRL_REG4			0x23
#define LSM303_ACCELEROMETER_CTRL_REG5			0x24
#define LSM303_ACCELEROMETER_HP_FILTER_RESET	0x25
#define LSM303_ACCELEROMETER_REFERENCE			0x26
#define LSM303_ACCELEROMETER_STATUS_REG			0x27
#define LSM303_ACCELEROMETER_OUT_X_L			0x28
#define LSM303_ACCELEROMETER_OUT_X_H			0x29
#define LSM303_ACCELEROMETER_OUT_Y_L			0x2A
#define LSM303_ACCELEROMETER_OUT_Y_H			0x2B
#define LSM303_ACCELEROMETER_OUT_Z_L			0x2C
#define LSM303_ACCELEROMETER_OUT_Z_H			0x2D
#define LSM303_ACCELEROMETER_INT1_CFG			0x30
#define LSM303_ACCELEROMETER_INT1_SOURCE		0x31
#define LSM303_ACCELEROMETER_INT1_THS			0x32
#define LSM303_ACCELEROMETER_INT1_DURATION		0x33
#define LSM303_ACCELEROMETER_INT2_CFG			0x34
#define LSM303_ACCELEROMETER_INT2_SOURCE		0x35
#define LSM303_ACCELEROMETER_INT2_THS			0x36
#define LSM303_ACCELEROMETER_INT2_DURATION		0x37

#define LSM303_MAGNETOMETER_CRA_REG				0x00
#define LSM303_MAGNETOMETER_CRB_REG				0x01
#define LSM303_MAGNETOMETER_MR_REG				0x02
#define LSM303_MAGNETOMETER_OUT_X_H				0x03
#define LSM303_MAGNETOMETER_OUT_X_L				0x04
#define LSM303_MAGNETOMETER_OUT_Z_H				0x05
#define LSM303_MAGNETOMETER_OUT_Z_L				0x06
#define LSM303_MAGNETOMETER_OUT_Y_H				0x07
#define LSM303_MAGNETOMETER_OUT_Y_L				0x08
#define LSM303_MAGNETOMETER_SR_REG				0x09
#define LSM303_MAGNETOMETER_IRA_REG				0x0A
#define LSM303_MAGNETOMETER_IRB_REG				0x0B
#define LSM303_MAGNETOMETER_IRC_REG				0x0C
#define LSM303_MAGNETOMETER_WHO_AM_I			0x0F

//Accelerometer register descriptions
#define LSM303_ACCELEROMETER_POWER_DOWN			0x00
#define LSM303_ACCELEROMETER_NORMAL_MODE		0x20
#define LSM303_ACCELEROMETER_LP_0_5HZ			0x40
#define LSM303_ACCELEROMETER_LP_1HZ				0x60
#define LSM303_ACCELEROMETER_LP_2HZ				0x80
#define LSM303_ACCELEROMETER_LP_5HZ				0xA0
#define LSM303_ACCELEROMETER_LP_10HZ			0xC0

#define LSM303_ACCELEROMETER_ODR_50HZ			0x00
#define LSM303_ACCELEROMETER_ODR_100HZ			0x08
#define LSM303_ACCELEROMETER_ODR_400HZ			0x10
#define LSM303_ACCELEROMETER_ODR_1000HZ			0x18

#define LSM303_ACCELEROMETER_XON				0x01
#define LSM303_ACCELEROMETER_YON				0x02
#define LSM303_ACCELEROMETER_ZON				0x04




//Magnetometer register descriptions
#define LSM303_MAGNETOMETER_DR_0_75HZ			0x00
#define LSM303_MAGNETOMETER_DR_1_5HZ			0x04
#define LSM303_MAGNETOMETER_DR_3_0HZ			0x08
#define LSM303_MAGNETOMETER_DR_7_5HZ			0x0C
#define LSM303_MAGNETOMETER_DR_15HZ				0x10
#define LSM303_MAGNETOMETER_DR_30HZ				0x14
#define LSM303_MAGNETOMETER_DR_75HZ				0x18
#define LSM303_MAGNETOMETER_DR_220HZ			0x1C

#define LSM303_MAGNETOMETER_GAIN_1_3G			0x20
#define LSM303_MAGNETOMETER_GAIN_1_9G			0x40
#define LSM303_MAGNETOMETER_GAIN_2_5G			0x60
#define LSM303_MAGNETOMETER_GAIN_4_0G			0x80
#define LSM303_MAGNETOMETER_GAIN_4_7G			0xA0
#define LSM303_MAGNETOMETER_GAIN_5_6G			0xC0
#define LSM303_MAGNETOMETER_GAIN_8_1G			0xE0

#define LSM303_MAGNETOMETER_MODE_CONTINUOUS		0x00
#define LSM303_MAGNETOMETER_MODE_SINGLE			0x01
#define LSM303_MAGNETOMETER_MODE_SLEEP			0x02


uint16_t LSM303MagnetometerData[3];
uint16_t LSM303AccelerometerData[3];


typedef enum
{
	LSM303_ACCELEROMETER,
	LSM303_MAGNETOMETER
} LSM303Device;


//Holds data to send to the LSM303
uint8_t LSM303WriteBuffer[LSM303_BUFFER_SIZE];

//Holds data recieved from the LSM303
uint8_t LSM303ReadBuffer[LSM303_BUFFER_SIZE];

int LSM303Init( void );
uint8_t LSM303WriteReg(LSM303Device LSM303_DEV, uint8_t RegToWrite, uint8_t ValueToWrite);
uint8_t LSM303ReadReg(LSM303Device LSM303_DEV, uint8_t RegToRead);
uint8_t LSM303ReadData(LSM303Device LSM303_DEV);


int LSM303SendCommand(int LSM303_DEV, int command);


#endif
